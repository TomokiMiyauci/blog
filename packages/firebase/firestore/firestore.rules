rules_version = '2'

service cloud.firestore {
  function isValidUsers(user) {
    return user.size () == 2 &&
    'createdAt' in user && user.createdAt is timestamp &&
    'updatedAt' in user && user.updatedAt is timestamp
  }

  function isValidArticles(article) {
    return article.size () == 2 || article.size () == 1 &&
    'view' in article && article.view is int ||
    'like' in article && article.like is int
  }

  function isValidLikedUsers(likedUser) {
    return likedUser.size() == 1 &&
    'userRef' in likedUser && likedUser.userRef is path
  }

  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if false;
    }

    match /users/{uid} {
      allow create: if isValidUsers(request.resource.data);
    }

    match /articles/{slug} {
      allow read;

      allow create, update: if isValidArticles(request.resource.data);

      match /likedUsers/{likedUser} {
        allow read, delete;

        allow create, update: if isValidLikedUsers(request.resource.data);
      }
    }
  }
}
